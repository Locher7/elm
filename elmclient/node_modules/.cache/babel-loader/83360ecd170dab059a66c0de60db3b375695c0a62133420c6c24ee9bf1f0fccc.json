{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nimport { ref, inject, onMounted, watch, computed, onUnmounted } from 'vue';\nimport { useRouter } from 'vue-router';\nimport axios from 'axios';\nimport qs from 'qs';\nimport md5 from 'js-md5';\nimport Footer from '../components/Footer.vue';\nexport default {\n  name: 'UpdateInfo',\n  components: {\n    Footer\n  },\n  setup() {\n    const confirmPassword = ref('');\n    const user = ref(JSON.parse(sessionStorage.getItem('user')));\n    const newPassword = ref('');\n    const router = useRouter();\n    const pastPassword = ref('');\n    const successShowModal = ref(false);\n\n    // 更新密码请求\n    const updateInfo = () => {\n      if (pastPassword.value == '') {\n        alert('旧密码不能为空!');\n        return;\n      }\n      if (newPassword.value == '') {\n        alert('密码不能为空!');\n        return;\n      }\n      if (newPassword.value != confirmPassword.value) {\n        alert('两次输入的密码不一致!');\n        return;\n      }\n      // 修改密码\n      checkOldPassword().then(isValid => {\n        let url1 = `http://localhost:10100/UserController//editPasswordByUserId/${user.value.userId}/${newPassword.value}`;\n        if (isValid) {\n          // 如果旧密码正确，则更新新密码\n          axios.put(url1).then(response => {\n            if (response.data.result == 1) {\n              successShowModal.value = true;\n              setTimeout(() => {\n                router.push('/myInfo');\n              }, 1000);\n            } else {\n              alert('修改密码失败!');\n            }\n          }).catch(error => {\n            console.error(error);\n          });\n        } else {\n          alert('旧密码错误!');\n        }\n      });\n    };\n\n    // 检查旧密码是否正确\n    const checkOldPassword = () => {\n      let url2 = `http://localhost:10100/UserController/getUserByIdByPass/${user.value.userId}/${pastPassword.value}`;\n      //如果旧密码正确则解析为true，否则为false。\n      return new Promise((resolve, reject) => {\n        axios.get(url2).then(response => {\n          if (response.data.result == null) {\n            resolve(false); // 旧密码错误\n          } else {\n            resolve(true); // 旧密码正确\n          }\n        }).catch(error => {\n          console.error(error);\n          alert('验证旧密码时出错，请稍后重试!');\n          reject(error);\n        });\n      });\n    };\n    return {\n      confirmPassword,\n      user,\n      newPassword,\n      pastPassword,\n      successShowModal,\n      updateInfo,\n      checkOldPassword\n    };\n  }\n};","map":{"version":3,"names":["ref","inject","onMounted","watch","computed","onUnmounted","useRouter","axios","qs","md5","Footer","name","components","setup","confirmPassword","user","JSON","parse","sessionStorage","getItem","newPassword","router","pastPassword","successShowModal","updateInfo","value","alert","checkOldPassword","then","isValid","url1","userId","put","response","data","result","setTimeout","push","catch","error","console","url2","Promise","resolve","reject","get"],"sources":["F:\\elmprogram\\elm\\elmclient\\src\\views\\EditInfo.vue"],"sourcesContent":["<template>\r\n\t<div class=\"wrapper\">\r\n\t\t<header>\r\n\t\t\t<p>修改密码</p>\r\n\t\t</header>\r\n\t\t<div class=\"head\">\r\n\t\t\t<img src=\"../assets/brand.png\">\r\n\t\t</div>\r\n\r\n\t\t<!-- 输入框 -->\r\n\t\t<ul class=\"info-section\">\r\n\t\t\t<li class=\"info-item\">\r\n\t\t\t\t<div class=\"content\">\r\n\t\t\t\t\t<i class=\"fa fa-user\"></i>\r\n\t\t\t\t\t<input type=\"password\" v-model=\"pastPassword\" placeholder=\"请输入旧密码\">\r\n\t\t\t\t</div>\r\n\t\t\t</li>\r\n\r\n\t\t\t<li class=\"info-item\">\r\n\t\t\t\t<div class=\"content\">\r\n\t\t\t\t\t<i class=\"fa fa-lock\"></i>\r\n\t\t\t\t\t<input type=\"password\" v-model=\"newPassword\" placeholder=\"请输入新密码\">\r\n\t\t\t\t</div>\r\n\t\t\t</li>\r\n\r\n\t\t\t<li class=\"info-item\">\r\n\t\t\t\t<div class=\"content\">\r\n\t\t\t\t\t<i class=\"fa fa-check-circle\"></i>\r\n\t\t\t\t\t<input type=\"password\" v-model=\"confirmPassword\" placeholder=\"确认新密码\">\r\n\t\t\t\t</div>\r\n\r\n\t\t\t</li>\r\n\t\t</ul>\r\n\r\n\t\t<div class=\"update-button\">\r\n\t\t\t<button @click=\"updateInfo\">确认更改</button>\r\n\t\t</div>\r\n\r\n\t\t<!-- 修改成功弹窗 -->\r\n\t\t<div class=\"modal\" v-if=\"successShowModal\">\r\n\t\t\t<div class=\"modal-content\">\r\n\t\t\t\t<i class=\"fa fa-check-circle success-icon\"></i>\r\n\t\t\t\t<p>修改密码成功</p>\r\n\t\t\t</div>\r\n\t\t</div>\r\n\r\n\t\t<!-- 底部菜单部分 -->\r\n\t\t<Footer></Footer>\r\n\t</div>\r\n</template>\r\n\r\n\r\n<script>\r\n\timport {\r\n\t\tref,\r\n\t\tinject,\r\n\t\tonMounted,\r\n\t\twatch,\r\n\t\tcomputed,\r\n\t\tonUnmounted\r\n\t} from 'vue';\r\n\timport {\r\n\t\tuseRouter\r\n\t} from 'vue-router';\r\n\timport axios from 'axios';\r\n\timport qs from 'qs';\r\n\timport md5 from 'js-md5';\r\n\timport Footer from '../components/Footer.vue';\r\n\texport default {\r\n\t\tname: 'UpdateInfo',\r\n\t\tcomponents: {\r\n\t\t\tFooter\r\n\t\t},\r\n\t\tsetup() {\r\n\t\t\tconst confirmPassword = ref('');\r\n\t\t\tconst user = ref(JSON.parse(sessionStorage.getItem('user')));\r\n\t\t\tconst newPassword = ref('');\r\n\t\t\tconst router = useRouter();\r\n\t\t\tconst pastPassword = ref('');\r\n\t\t\tconst successShowModal = ref(false);\r\n\r\n\r\n\t\t\t// 更新密码请求\r\n\t\t\tconst updateInfo = () => {\r\n\t\t\t\tif (pastPassword.value == '') {\r\n\t\t\t\t\talert('旧密码不能为空!');\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\tif (newPassword.value == '') {\r\n\t\t\t\t\talert('密码不能为空!');\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\tif (newPassword.value != confirmPassword.value) {\r\n\t\t\t\t\talert('两次输入的密码不一致!');\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\t// 修改密码\r\n\t\t\t\tcheckOldPassword().then(isValid => {\r\n\t\t\t\t\tlet url1 =`http://localhost:10100/UserController//editPasswordByUserId/${user.value.userId}/${newPassword.value}`;\r\n\t\t\t\t\tif (isValid) {\r\n\t\t\t\t\t\t// 如果旧密码正确，则更新新密码\r\n\t\t\t\t\t\taxios.put(url1).then((response) => {\r\n\t\t\t\t\t\t\tif (response.data.result == 1) {\r\n\t\t\t\t\t\t\t\tsuccessShowModal.value = true;\r\n\t\t\t\t\t\t\t\tsetTimeout(() => {\r\n\t\t\t\t\t\t\t\t\trouter.push('/myInfo');\r\n\t\t\t\t\t\t\t\t}, 1000);\r\n\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\talert('修改密码失败!');\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}).catch((error) => {\r\n\t\t\t\t\t\t\tconsole.error(error);\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\talert('旧密码错误!');\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t};\r\n\r\n\t\t\t// 检查旧密码是否正确\r\n\t\t\tconst checkOldPassword = () => {\r\n\t\t\t\tlet url2 =`http://localhost:10100/UserController/getUserByIdByPass/${user.value.userId}/${pastPassword.value}`;\r\n\t\t\t\t//如果旧密码正确则解析为true，否则为false。\r\n\t\t\t\treturn new Promise((resolve, reject) => {\r\n\t\t\t\t\taxios.get(url2).then(response => {\r\n\t\t\t\t\t\tif (response.data.result == null) {\r\n\t\t\t\t\t\t\tresolve(false); // 旧密码错误\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tresolve(true); // 旧密码正确\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}).catch(error => {\r\n\t\t\t\t\t\tconsole.error(error);\r\n\t\t\t\t\t\talert('验证旧密码时出错，请稍后重试!');\r\n\t\t\t\t\t\treject(error);\r\n\t\t\t\t\t});\r\n\t\t\t\t});\r\n\t\t\t};\r\n\r\n\r\n\t\t\treturn {\r\n\t\t\t\tconfirmPassword,\r\n\t\t\t\tuser,\r\n\t\t\t\tnewPassword,\r\n\t\t\t\tpastPassword,\r\n\t\t\t\tsuccessShowModal,\r\n\t\t\t\tupdateInfo,\r\n\t\t\t\tcheckOldPassword\r\n\t\t\t};\r\n\t\t}\r\n\t}\r\n</script>\r\n\r\n<style scoped>\r\n\t/* 总容器 */\r\n\t.wrapper {\r\n\t\twidth: 100%;\r\n\t\theight: 100%;\r\n\t\tbackground-color: #fff;\r\n\t\tdisplay: flex;\r\n\t\tflex-direction: column;\r\n\t}\r\n\r\n\t.wrapper header {\r\n\t\twidth: 100%;\r\n\t\theight: 12vw;\r\n\t\tbackground-color: #0097ff;\r\n\t\tcolor: #fff;\r\n\t\tfont-size: 4.8vw;\r\n\r\n\t\tposition: fixed;\r\n\t\tleft: 0;\r\n\t\ttop: 0;\r\n\t\tz-index: 1000;\r\n\r\n\t\tdisplay: flex;\r\n\t\tjustify-content: center;\r\n\t\talign-items: center;\r\n\t}\r\n\r\n\t/****************** header ****************/\r\n\t.head {\r\n\t\tmargin-top: 25vw;\r\n\t\tdisplay: flex;\r\n\t\tflex-direction: column;\r\n\t\talign-items: center;\r\n\t}\r\n\r\n\t.head img {\r\n\t\twidth: 40vw;\r\n\t\theight: 40vw;\r\n\t}\r\n\r\n\t/****************** 表单信息 ****************/\r\n\t.info-section {\r\n\t\twidth: 80%;\r\n\t\tmargin: 6vw auto;\r\n\t\tborder-radius: 8px;\r\n\t\tdisplay: flex;\r\n\t\tflex-direction: column;\r\n\t\tjustify-content: space-around;\r\n\t}\r\n\r\n\t.info-section li {\r\n\t\tbox-sizing: border-box;\r\n\t\tmargin: 2vw 2vw 0 0;\r\n\t\tdisplay: flex;\r\n\t\talign-items: center;\r\n\t\tborder: #f4eeee solid;\r\n\t\tborder-width: 0px 0px 1.8px 0px;\r\n\t}\r\n\r\n\t.info-item {\r\n\t\tdisplay: flex;\r\n\t\talign-items: center;\r\n\t\tpadding: 10px;\r\n\t\tmargin-bottom: 20px;\r\n\r\n\t}\r\n\r\n\t.info-item i {\r\n\t\tmargin-right: 10px;\r\n\t\tfont-size: 20px;\r\n\t\tcolor: #0097ff;\r\n\t\twidth: 10%;\r\n\t}\r\n\r\n\t.info-item input {\r\n\t\tflex: 1;\r\n\t\tfont-size: 16px;\r\n\t\tborder: none;\r\n\t\toutline: none;\r\n\t}\r\n\r\n\t.info-item .content {\r\n\t\twidth: 100%;\r\n\t}\r\n\r\n\t.update-button {\r\n\t\ttext-align: center;\r\n\t\tmargin-top: 20px;\r\n\t}\r\n\r\n\t.update-button button {\r\n\t\tpadding: 12px 40px;\r\n\t\tbackground-color: #0097ff;\r\n\t\tborder: none;\r\n\t\tborder-radius: 8px;\r\n\t\tcolor: white;\r\n\t\tfont-size: 18px;\r\n\t\tfont-weight: 500;\r\n\t\tcursor: pointer;\r\n\t\ttransition: background-color 0.3s;\r\n\t}\r\n\r\n\t/****************** 修改密码成功弹窗 ****************/\r\n\t.modal {\r\n\t\tposition: fixed;\r\n\t\ttop: 0;\r\n\t\tleft: 0;\r\n\t\twidth: 100%;\r\n\t\theight: 100%;\r\n\t\tbackground-color: rgba(0, 0, 0, 0.75);\r\n\t\tdisplay: flex;\r\n\t\tjustify-content: center;\r\n\t\talign-items: center;\r\n\t\tz-index: 2000;\r\n\t}\r\n\r\n\t.modal-content {\r\n\t\twidth: 80%;\r\n\t\tmax-width: 500px;\r\n\t\tpadding: 30px;\r\n\t\tborder-radius: 15px;\r\n\t\tbackground-color: #ffffff;\r\n\t\ttext-align: center;\r\n\t\tbox-shadow: 0px 0px 20px rgba(0, 0, 0, 0.5);\r\n\t}\r\n\r\n\t.success-icon {\r\n\t\tfont-size: 80px;\r\n\t\tcolor: #4CAF50;\r\n\t\tmargin-bottom: 30px;\r\n\t}\r\n</style>\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}